# The manifest for the "api" service.
# Load Balanced Web Service
# https://aws.github.io/copilot-cli/docs/manifest/lb-web-service/

name: api
type: Load Balanced Web Service

http:
  path: '/'
  healthcheck: '/v1/health'

image:
  build:
    context: .
    dockerfile: backend/api/Dockerfile
  port: 8000

cpu: 256
memory: 512
count: 1
exec: true

network:
  connect: true

# ---------------------------------------------------------
# LLM Runtime Configuration (Bedrock â€“ Dev Default)
# ---------------------------------------------------------

variables:
  AWS_REGION: us-east-1
  LLM_PROVIDER: bedrock
  # Use the inference profile ARN (NOT the foundation model id) to avoid on-demand validation errors.
  LLM_MODEL_IDENTIFIER: arn:aws:bedrock:us-east-1:456462539706:inference-profile/us.meta.llama3-1-8b-instruct-v1:0
  LLM_TIMEOUT_SECONDS: "120"
  LLM_TRACE_ENABLED: "1"

# ---------------------------------------------------------
# IAM Permissions for ECS Task Role
# ---------------------------------------------------------
# NOTE:
# Re-deploy the service after editing this file so Copilot updates the TaskRole.


# ---------------------------------------------------------
# Optional environment-specific overrides
# ---------------------------------------------------------
# environments:
#   dev:
#     variables:
#       LLM_TRACE_ENABLED: "1"
#   prod:
#     variables:
#       LLM_TRACE_ENABLED: "0"
